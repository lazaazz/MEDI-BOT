<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HealthSync Solutions</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Poppins:wght@700;800&display=swap" rel="stylesheet">
  <!-- Leaflet for OSM map preview -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Tesseract.js for OCR -->
  <script src="https://unpkg.com/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <!-- OpenCV.js for image preprocessing -->
  <script async src="https://docs.opencv.org/4.5.5/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', sans-serif;
      line-height: 1.7;
      color: #1f2937;
      background: linear-gradient(135deg, #f0f9ff, #e0e7ff);
      overflow-x: hidden;
      transition: background 0.3s ease, color 0.3s ease;
    }

    body.dark-mode {
      background: linear-gradient(135deg, #1e293b, #334155);
      color: #e2e8f0;
    }

    /* Navigation */
    nav {
      position: sticky;
      top: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 4rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode nav {
      background: rgba(30, 41, 59, 0.95);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    nav h1 {
      font-family: 'Poppins', sans-serif;
      color: #1e3a8a;
      font-size: 2rem;
      font-weight: 800;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode nav h1 {
      color: #93c5fd;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 2rem;
      align-items: center;
    }

    nav ul li a {
      color: #1e3a8a;
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      position: relative;
      transition: color 0.3s ease;
    }

    body.dark-mode nav ul li a {
      color: #e2e8f0;
    }

    nav ul li a::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -6px;
      left: 0;
      background-color: #3b82f6;
      transition: width 0.3s ease;
    }

    nav ul li a:hover::after {
      width: 100%;
    }

    nav ul li a:hover {
      color: #3b82f6;
    }

    .auth-btn, .profile-btn, .logout-btn, .theme-toggle {
      padding: 0.5rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      border: 2px solid #3b82f6;
      background: transparent;
      color: #1e3a8a;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    body.dark-mode .auth-btn, body.dark-mode .profile-btn, body.dark-mode .logout-btn, body.dark-mode .theme-toggle {
      border-color: #93c5fd;
      color: #e2e8f0;
    }

    .auth-btn:hover, .profile-btn:hover, .logout-btn:hover, .theme-toggle:hover {
      background: #3b82f6;
      color: white;
    }

    body.dark-mode .auth-btn:hover, body.dark-mode .profile-btn:hover, body.dark-mode .logout-btn:hover, body.dark-mode .theme-toggle:hover {
      background: #93c5fd;
      color: #1e293b;
    }

    .mobile-toggle {
      display: none;
      font-size: 1.5rem;
      color: #1e3a8a;
      cursor: pointer;
    }

    body.dark-mode .mobile-toggle {
      color: #e2e8f0;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .modal-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 2rem;
      border-radius: 20px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      animation: fadeIn 0.3s ease;
    }

    body.dark-mode .modal-content {
      background: rgba(30, 41, 59, 0.95);
      color: #e2e8f0;
    }

    .modal-content h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 2rem;
      color: #1e3a8a;
      margin-bottom: 1.5rem;
    }

    body.dark-mode .modal-content h3 {
      color: #93c5fd;
    }

    .modal-content input, .modal-content select {
      width: 100%;
      padding: 0.9rem;
      margin-bottom: 1.2rem;
      border: 1px solid #d1d5db;
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    body.dark-mode .modal-content input, body.dark-mode .modal-content select {
      border-color: #475569;
      background: #1e293b;
      color: #e2e8f0;
    }

    .modal-content input:focus, .modal-content select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
    }

    .modal-content button {
      width: 100%;
      padding: 0.9rem;
      font-size: 1.1rem;
      font-weight: 600;
      background: linear-gradient(45deg, #3b82f6, #1e3a8a);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    body.dark-mode .modal-content button {
      background: linear-gradient(45deg, #93c5fd, #3b82f6);
    }

    .modal-content button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.5);
    }

    .close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 1.8rem;
      color: #4b5563;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    body.dark-mode .close-btn {
      color: #94a3b8;
    }

    .close-btn:hover {
      color: #1e3a8a;
    }

    body.dark-mode .close-btn:hover {
      color: #93c5fd;
    }

    /* Image Preview Modal */
    #imagePreviewModal .modal-content img {
      max-width: 100%;
      max-height: 400px;
      display: block;
      margin: 1rem auto;
      border-radius: 10px;
    }

    #imagePreviewModal .modal-content .button-container {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    /* Preprocessed Image in Chat */
    .preprocessed-image {
      max-width: 200px;
      margin-top: 1rem;
      border-radius: 10px;
    }

    /* Sections */
    section {
      min-height: 100vh;
      padding: 8rem 4rem 4rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s ease, transform 0.8s ease;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: inherit;
      opacity: 0.3;
      z-index: -1;
    }

    section.visible {
      opacity: 1;
      transform: translateY(0);
    }

    #home {
      background: linear-gradient(135deg, #1e3a8a, #3b82f6);
      color: white;
    }

    body.dark-mode #home {
      background: linear-gradient(135deg, #1e293b, #3b82f6);
    }

    #about {
      background: linear-gradient(135deg, #f0f9ff, #e0e7ff);
    }

    body.dark-mode #about {
      background: linear-gradient(135deg, #1e293b, #334155);
    }

    #services {
      background: linear-gradient(135deg, #f0f9ff, #e0e7ff);
    }

    body.dark-mode #services {
      background: linear-gradient(135deg, #1e293b, #334155);
    }

    #team {
      background: linear-gradient(135deg, #f0f9ff, #e0e7ff);
    }

    body.dark-mode #team {
      background: linear-gradient(135deg, #1e293b, #334155);
    }

    #contact {
      background: linear-gradient(135deg, #f0f9ff, #e0e7ff);
    }

    body.dark-mode #contact {
      background: linear-gradient(135deg, #1e293b, #334155);
    }

    #chat {
      background: linear-gradient(135deg, #f0f9ff, #e0e7ff);
    }

    body.dark-mode #chat {
      background: linear-gradient(135deg, #1e293b, #334155);
    }

    .text-box {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(8px);
      padding: 3rem;
      border-radius: 20px;
      max-width: 1100px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
      text-align: center;
      z-index: 1;
    }

    body.dark-mode .text-box {
      background: rgba(30, 41, 59, 0.9);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
    }

    section h2 {
      font-family: 'Poppins', sans-serif;
      font-size: 3.5rem;
      font-weight: 800;
      margin-bottom: 1.5rem;
      color: #1e3a8a;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }

    body.dark-mode section h2 {
      color: #93c5fd;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
    }

    section p {
      font-size: 1.2rem;
      color: #4b5563;
      line-height: 1.8;
    }

    body.dark-mode section p {
      color: #d1d5db;
    }

    /* Hero Section */
    #home::before {
      background: rgba(0, 0, 0, 0.3);
      z-index: 0;
    }

    #home > * {
      z-index: 1;
    }

    #home .text-box h2 {
      font-size: 5rem;
      text-shadow: 3px 3px 20px rgba(0, 0, 0, 0.5);
      animation: scaleIn 1.5s ease-in-out;
    }

    #home .text-box p {
      font-size: 1.5rem;
      color: #93c5fd;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* Services */
    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 2rem auto;
      z-index: 1;
    }

    .service-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(8px);
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
      z-index: 1;
      text-align: center;
    }

    body.dark-mode .service-card {
      background: rgba(30, 41, 59, 0.9);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .service-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }

    .service-card i {
      font-size: 2.5rem;
      color: #3b82f6;
      margin-bottom: 1rem;
    }

    .service-card h3 {
      font-family: 'Poppins', sans-serif;
      font-size: 1.5rem;
      color: #1e3a8a;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .service-card h3 {
      color: #93c5fd;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    /* Contact */
    #contact .contact-container {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      max-width: 1200px;
      width: 100%;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(8px);
      border-radius: 20px;
      padding: 3rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      z-index: 1;
    }

    body.dark-mode #contact .contact-container {
      background: rgba(30, 41, 59, 0.9);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    #contact .contact-form {
      flex: 1;
      min-width: 300px;
    }

    #contact .contact-form h2 {
      font-size: 2.5rem;
    }

    #contact .contact-form input,
    #contact .contact-form textarea {
      width: 100%;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border: 1px solid #d1d5db;
      border-radius: 10px;
      font-size: 1rem;
    }

    body.dark-mode #contact .contact-form input,
    body.dark-mode #contact .contact-form textarea {
      border-color: #475569;
      background: #1e293b;
      color: #e2e8f0;
    }

    #contact .contact-form input:focus,
    #contact .contact-form textarea:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
    }

    #contact .contact-form textarea {
      height: 150px;
      resize: none;
    }

    #contact .contact-form button {
      padding: 1rem 2.5rem;
      background: linear-gradient(45deg, #3b82f6, #1e3a8a);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    body.dark-mode #contact .contact-form button {
      background: linear-gradient(45deg, #93c5fd, #3b82f6);
    }

    #contact .contact-form button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.5);
    }

    #contact .contact-info {
      flex: 1;
      min-width: 300px;
      text-align: left;
    }

    #contact .social-links a {
      color: #1e3a8a;
      font-size: 2rem;
      margin-right: 1.5rem;
      transition: transform 0.3s ease;
    }

    body.dark-mode #contact .social-links a {
      color: #93c5fd;
    }

    #contact .social-links a:hover {
      transform: scale(1.2);
      color: #3b82f6;
    }

    /* Chatbot */
    #chat .chatbox {
      width: 100%;
      max-width: 900px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    body.dark-mode #chat .chatbox {
      background: rgba(30, 41, 59, 0.95);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .chatbox textarea {
      width: 100%;
      min-height: 100px;
      padding: 1.2rem;
      font-size: 1.1rem;
      border: 1px solid #d1d5db;
      border-radius: 15px;
      resize: vertical;
      background: #f8fafc;
      transition: border-color 0.3s ease;
    }

    body.dark-mode .chatbox textarea {
      border-color: #475569;
      background: #1e293b;
      color: #e2e8f0;
    }

    .chatbox textarea:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
    }

    .chatbox .typing-indicator {
      display: none;
      font-size: 1rem;
      color: #4b5563;
      margin-bottom: 1rem;
    }

    body.dark-mode .chatbox .typing-indicator {
      color: #d1d5db;
    }

    .chatbox .typing-indicator span {
      animation: blink 1s infinite;
    }

    .chatbox .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .chatbox .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes blink {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }

    .chatbox .chat-controls {
      display: flex;
      gap: 1rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }

    .chatbox button, .quick-reply {
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      background: linear-gradient(45deg, #3b82f6, #1e3a8a);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    body.dark-mode .chatbox button, body.dark-mode .quick-reply {
      background: linear-gradient(45deg, #93c5fd, #3b82f6);
    }

    .chatbox button:hover, .quick-reply:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(59, 130, 246, 0.5);
    }

    .voice-btn {
      background: linear-gradient(45deg, #10b981, #059669);
    }

    body.dark-mode .voice-btn {
      background: linear-gradient(45deg, #34d399, #10b981);
    }

    .voice-btn.listening {
      background: linear-gradient(45deg, #ef4444, #b91c1c);
    }

    .speak-btn {
      background: linear-gradient(45deg, #8b5cf6, #6d28d9);
    }

    body.dark-mode .speak-btn {
      background: linear-gradient(45deg, #a78bfa, #8b5cf6);
    }

    .speak-btn.speaking {
      background: linear-gradient(45deg, #f97316, #ea580c);
    }

    .upload-btn {
      background: linear-gradient(45deg, #f59e0b, #d97706);
    }

    body.dark-mode .upload-btn {
      background: linear-gradient(45deg, #fbbf24, #f59e0b);
    }

    .language-select {
      padding: 0.8rem;
      font-size: 1rem;
      border: 1px solid #d1d5db;
      border-radius: 10px;
      background: #f8fafc;
      cursor: pointer;
    }

    body.dark-mode .language-select {
      border-color: #475569;
      background: #1e293b;
      color: #e2e8f0;
    }

    .chat-messages {
      max-height: 400px;
      overflow-y: auto;
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 15px;
      background: #f8fafc;
    }

    body.dark-mode .chat-messages {
      background: #1e293b;
    }

    .message {
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 10px;
      max-width: 80%;
      animation: fadeIn 0.5s ease;
    }

    .user-message {
      background: #3b82f6;
      color: white;
      margin-left: auto;
      text-align: right;
    }

    .bot-message {
      background: #e5e7eb;
      color: #1f2937;
    }

    body.dark-mode .bot-message {
      background: #475569;
      color: #e2e8f0;
    }

    .quick-replies {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    /* Optional map preview */
    #clinic-map {
      height: 200px;
      margin-top: 10px;
      border-radius: 8px;
      display: none;
    }

    /* Footer */
    footer {
      background: #1e3a8a;
      color: white;
      padding: 3rem 4rem;
      text-align: center;
    }

    body.dark-mode footer {
      background: #1e293b;
    }

    footer a {
      color: #93c5fd;
      text-decoration: none;
    }

    footer a:hover {
      color: #fefcbf;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes scaleIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      nav ul {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 60px;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        padding: 1rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      body.dark-mode nav ul {
        background: rgba(30, 41, 59, 0.95);
      }

      nav ul.active {
        display: flex;
      }

      .mobile-toggle {
        display: block;
      }

      section {
        padding: 6rem 2rem 2rem;
      }

      #contact .contact-container {
        flex-direction: column;
      }

      .chatbox .chat-controls {
        flex-direction: column;
        align-items: stretch;
      }
    }

    .cta-btn {
      padding: 1rem 2.5rem;
      font-size: 1.2rem;
      font-weight: 600;
      border: none;
      background: linear-gradient(45deg, #3b82f6, #1e3a8a);
      color: white;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
      z-index: 1;
    }

    body.dark-mode .cta-btn {
      background: linear-gradient(45deg, #93c5fd, #3b82f6);
    }

    .cta-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.6);
    }
  </style>
</head>

<body>
  <nav>
    <h1>HealthSync Solutions</h1>
    <ul id="navLinks">
      <li><a href="#home">Home</a></li>
      <li><a href="#about">About</a></li>
      <li><a href="#services">Services</a></li>
      <li><a href="#team">Team</a></li>
      <li><a href="#contact">Contact</a></li>
      <li><a href="#chat">Chat</a></li>
      <li><button class="auth-btn" onclick="openModal('login')">Login</button></li>
      <li><button class="auth-btn" onclick="openModal('signup')">Sign Up</button></li>
      <li><button class="profile-btn" id="profileBtn" style="display: none;">Profile</button></li>
      <li><button class="logout-btn" id="logoutBtn" style="display: none;">Logout</button></li>
      <li><button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button></li>
    </ul>
    <i class="fas fa-bars mobile-toggle" onclick="toggleNav()"></i>
  </nav>

  <!-- Login Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('login')">Ã—</span>
      <h3>Login</h3>
      <input type="email" id="loginEmail" placeholder="Email" required>
      <input type="password" id="loginPassword" placeholder="Password" required>
      <button onclick="handleAuth('login')">Login</button>
    </div>
  </div>

  <!-- Signup Modal -->
  <div id="signupModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('signup')">Ã—</span>
      <h3>Sign Up</h3>
      <input type="text" id="signupName" placeholder="Full Name" required>
      <input type="email" id="signupEmail" placeholder="Email" required>
      <input type="password" id="signupPassword" placeholder="Password" required>
      <button onclick="handleAuth('signup')">Sign Up</button>
    </div>
  </div>

  <!-- Service Detail Modal -->
  <div id="serviceModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('service')">Ã—</span>
      <h3 id="serviceTitle"></h3>
      <p id="serviceDescription"></p>
    </div>
  </div>

  <!-- Symptom Tracker Modal -->
  <div id="symptomModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('symptom')">Ã—</span>
      <h3>Your Symptom History</h3>
      <ul id="symptomList" style="list-style: none; padding: 0;">
        <li>No symptoms recorded yet.</li>
      </ul>
    </div>
  </div>

  <!-- Image Preview Modal -->
  <div id="imagePreviewModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('imagePreview')">Ã—</span>
      <h3>Confirm Prescription Image</h3>
      <p>Is this image clear and legible? Select the language of the prescription.</p>
      <select id="ocrLanguageSelect">
        <option value="eng">English</option>
        <option value="tel">Telugu</option>
      </select>
      <img id="previewImage" src="" alt="Prescription Preview">
      <div class="button-container">
        <button onclick="processConfirmedImage()">Process Image</button>
        <button onclick="closeModal('imagePreview'); document.getElementById('prescriptionUpload').value = '';">Cancel</button>
      </div>
    </div>
  </div>

  <section id="home">
    <div class="text-box">
      <h2>Empowering Your Health Journey</h2>
      <p>HealthSync Solutions delivers cutting-edge, AI-driven healthcare tools to provide personalized, accessible, and trustworthy medical guidance anytime, anywhere.</p>
      <button class="cta-btn" onclick="scrollToChat()">Get Started</button>
    </div>
  </section>

  <section id="about">
    <div class="text-box">
      <h2>Who We Are</h2>
      <p>At HealthSync, we combine advanced technology with a passion for human well-being. Our mission is to make healthcare intuitive, inclusive, and impactful, empowering millions to take control of their health with confidence.</p>
    </div>
  </section>

  <section id="services">
    <div class="text-box">
      <h2>Our Services</h2>
      <p>Discover our suite of innovative tools designed to support your health and wellness needs.</p>
    </div>
    <div class="services-grid">
      <div class="service-card" onclick="openServiceModal('Symptom Checker', 'Get instant insights into your symptoms with our AI-powered diagnostic tool. Input your symptoms and receive tailored suggestions for next steps.')">
        <i class="fas fa-stethoscope"></i>
        <h3>Symptom Checker</h3>
        <p>Get instant insights into your symptoms.</p>
      </div>
      <div class="service-card" onclick="openServiceModal('HealthBot AI', 'Ask questions about diseases, treatments, and more with our intelligent assistant. Available 24/7 with multilingual support.')">
        <i class="fas fa-robot"></i>
        <h3>HealthBot AI</h3>
        <p>Ask questions about diseases and treatments.</p>
      </div>
      <div class="service-card" onclick="openServiceModal('Wellness Plans', 'Personalized health and fitness recommendations tailored to your lifestyle. Includes diet plans, exercise routines, and mental health tips.')">
        <i class="fas fa-heartbeat"></i>
        <h3>Wellness Plans</h3>
        <p>Personalized health recommendations.</p>
      </div>
    </div>
  </section>

  <section id="team">
    <div class="text-box">
      <h2>Our Expert Team</h2>
      <p>Our team of medical professionals, data scientists, and engineers work together to bring you the best in digital healthcare innovation.</p>
      <button class="cta-btn" onclick="window.location.href='#contact'">Meet the Team</button>
    </div>
  </section>

  <section id="contact">
    <div class="text-box">
      <h2>Connect With Us</h2>
      <p>We're here to answer your questions or explore partnerships!</p>
    </div>
    <div class="contact-container">
      <div class="contact-form">
        <input type="text" id="contactName" placeholder="Your Name" required>
        <input type="email" id="contactEmail" placeholder="Your Email" required>
        <textarea id="contactMessage" placeholder="Your Message" required></textarea>
        <button onclick="handleContactSubmit()">Send Message</button>
      </div>
      <div class="contact-info">
        <h3>Get in Touch</h3>
        <p>Email: <a href="mailto:support@healthsync.com">support@healthsync.com</a></p>
        <p>Phone: <a href="tel:+1888HEALTHSYNC">+1-888-HEALTHSYNC</a></p>
        <p>Address: 123 Wellness Ave, Health City, HC 90210</p>
        <div class="social-links">
          <a href="https://twitter.com/healthsync" target="_blank"><i class="fab fa-x-twitter"></i></a>
          <a href="https://facebook.com/healthsync" target="_blank"><i class="fab fa-facebook-f"></i></a>
          <a href="https://linkedin.com/company/healthsync" target="_blank"><i class="fab fa-linkedin-in"></i></a>
          <a href="https://instagram.com/healthsync" target="_blank"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
    </div>
  </section>

  <section id="chat">
    <div class="text-box">
      <h2>HealthSync AI Assistant</h2>
      <p>Your 24/7 health companion â€“ ask anything, anytime.</p>
    </div>
    <div class="chatbox">
      <div class="chat-messages" id="chatMessages"></div>
      <div id="clinic-map"></div>
      <div class="typing-indicator" id="typingIndicator"><span>.</span><span>.</span><span>.</span> Typing</div>
      <textarea id="userInput" placeholder="Ask about symptoms, treatments, or general health advice... (e.g., *italic*, **bold**, ðŸ˜Š)"></textarea>
      <div class="chat-controls">
        <select id="languageSelect" class="language-select">
          <option value="en-US">English (US)</option>
          <option value="es-ES">Spanish</option>
          <option value="fr-FR">French</option>
          <option value="de-DE">German</option>
          <option value="zh-CN">Chinese (Simplified)</option>
          <option value="hi-IN">Hindi</option>
          <option value="te-IN">Telugu</option>
        </select>
        <button id="askBtn" onclick="sendMessage()">Ask HealthSync</button>
        <button id="voiceBtn" class="voice-btn" onclick="toggleVoiceInput()"><i class="fas fa-microphone"></i> Voice</button>
        <button id="speakBtn" class="speak-btn" onclick="toggleSpeech()"><i class="fas fa-volume-up"></i> Speak</button>
        <button id="symptomBtn" onclick="openModal('symptom')"><i class="fas fa-notes-medical"></i> View Symptoms</button>
        <button id="uploadBtn" class="upload-btn" onclick="document.getElementById('prescriptionUpload').click()"><i class="fas fa-upload"></i> Upload Prescription</button>
        <input type="file" id="prescriptionUpload" accept="image/*" style="display: none;" onchange="previewPrescriptionImage(event)">
      </div>
    </div>
  </section>

  <footer>
    <p>Â© 2025 HealthSync Solutions. All rights reserved. <a href="#privacy">Privacy Policy</a> | <a href="#terms">Terms of Service</a></p>
  </footer>

  <script>
    // *** PASTE YOUR GOOGLE GEMINI API KEY HERE ***
    const GOOGLE_GEMINI_API_KEY = 'AIzaSyAnaBTktO4b85ITz9q8qZSnYeBRPqDnIYY';

    // Fallback health responses
    const healthResponses = {
      'headache': {
        reply: 'A headache could be due to stress, dehydration, or lack of sleep. Try drinking water, resting, or taking an over-the-counter pain reliever like ibuprofen. **If it persists or worsens, consult a doctor.**',
        followUps: ['Tips for stress relief?', 'More about dehydration?']
      },
      'fever': {
        reply: 'A fever might indicate an infection. Rest, stay hydrated, and consider acetaminophen. *If your temperature exceeds 100.4Â°F (38Â°C) for over 48 hours, seek medical advice.*',
        followUps: ['How to stay hydrated?', 'When to see a doctor?']
      },
      'cough': {
        reply: 'A cough could stem from a cold, allergies, or respiratory issues. Stay hydrated, use a humidifier, or try honey. **Persistent coughing for over a week warrants a doctorâ€™s visit.**',
        followUps: ['Home remedies for cough?', 'Allergy tips?']
      },
      'stomach pain': {
        reply: 'Stomach pain may result from indigestion, gas, or infection. Avoid heavy meals, try antacids, and rest. *Severe or ongoing pain requires medical evaluation.*',
        followUps: ['Diet for indigestion?', 'When to seek help?']
      },
      'diet': {
        reply: 'A balanced diet includes fruits, vegetables, lean proteins, and whole grains. Limit processed foods and sugars. **Would you like a sample meal plan?**',
        followUps: ['Sample meal plan?', 'Healthy snacks?']
      },
      'exercise': {
        reply: 'Regular exercise improves health. Aim for 150 minutes of moderate activity weekly, like walking or yoga. *Start slow if youâ€™re new!*',
        followUps: ['Beginner workouts?', 'Yoga benefits?']
      },
      'default': {
        reply: 'Thanks for your question! I need more details to assist you better. Could you describe your symptoms or question further? ðŸ˜Š *For precise advice, consult a healthcare professional.*',
        followUps: ['Common symptoms?', 'General health tips?']
      }
    };

    // Multilingual translations
    const translations = {
      'en-US': {
        processing: 'Processing...',
        default: healthResponses.default.reply
      },
      'es-ES': {
        processing: 'Procesando...',
        default: 'Â¡Gracias por tu pregunta! Necesito mÃ¡s detalles. Â¿Puedes describir tus sÃ­ntomas o pregunta? ðŸ˜Š Consulta a un mÃ©dico para consejos precisos.'
      },
      'fr-FR': {
        processing: 'Traitement...',
        default: 'Merci pour votre question ! Jâ€™ai besoin de plus de dÃ©tails. Pouvez-vous dÃ©crire vos symptÃ´mes ? ðŸ˜Š Consultez un professionnel pour des conseils prÃ©cis.'
      },
      'de-DE': {
        processing: 'Verarbeitung...',
        default: 'Danke fÃ¼r deine Frage! Ich brauche mehr Details. Kannst du deine Symptome beschreiben? ðŸ˜Š Wende dich an einen Arzt fÃ¼r genaue RatschlÃ¤ge.'
      },
      'zh-CN': {
        processing: 'å¤„ç†ä¸­...',
        default: 'æ„Ÿè°¢æ‚¨çš„é—®é¢˜ï¼æˆ‘éœ€è¦æ›´å¤šç»†èŠ‚ã€‚æ‚¨èƒ½æè¿°æ‚¨çš„ç—‡çŠ¶å—ï¼ŸðŸ˜Š è¯·å’¨è¯¢åŒ»ç”Ÿä»¥èŽ·å¾—ç²¾ç¡®å»ºè®®ã€‚'
      },
      'hi-IN': {
        processing: 'à¤ªà¥à¤°à¤¸à¤‚à¤¸à¥à¤•à¤°à¤£...',
        default: 'à¤†à¤ªà¤•à¥‡ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤•à¥‡ à¤²à¤¿à¤ à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦! à¤®à¥à¤à¥‡ à¤”à¤° à¤µà¤¿à¤µà¤°à¤£ à¤šà¤¾à¤¹à¤¿à¤à¥¤ à¤•à¥à¤¯à¤¾ à¤†à¤ª à¤…à¤ªà¤¨à¥‡ à¤²à¤•à¥à¤·à¤£ à¤¬à¤¤à¤¾ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚? ðŸ˜Š à¤¸à¤Ÿà¥€à¤• à¤¸à¤²à¤¾à¤¹ à¤•à¥‡ à¤²à¤¿à¤ à¤¡à¥‰à¤•à¥à¤Ÿà¤° à¤¸à¥‡ à¤ªà¤°à¤¾à¤®à¤°à¥à¤¶ à¤•à¤°à¥‡à¤‚à¥¤'
      },
      'te-IN': {
        processing: 'à°ªà±à°°à°¾à°¸à±†à°¸à°¿à°‚à°—à±...',
        default: 'à°®à±€ à°ªà±à°°à°¶à±à°¨à°•à± à°§à°¨à±à°¯à°µà°¾à°¦à°¾à°²à±! à°¨à°¾à°•à± à°®à°°à°¿à°¨à±à°¨à°¿ à°µà°¿à°µà°°à°¾à°²à± à°•à°¾à°µà°¾à°²à°¿. à°®à±€ à°²à°•à±à°·à°£à°¾à°²à°¨à± à°µà°¿à°µà°°à°¿à°‚à°šà°—à°²à°°à°¾? ðŸ˜Š à°–à°šà±à°šà°¿à°¤à°®à±ˆà°¨ à°¸à°²à°¹à°¾ à°•à±‹à°¸à°‚ à°µà±ˆà°¦à±à°¯à±à°¡à°¿à°¨à°¿ à°¸à°‚à°ªà±à°°à°¦à°¿à°‚à°šà°‚à°¡à°¿.'
      }
    };

    // Symptom tracking
    let symptomHistory = [];
    let latestBotMessage = '';
    let speechUtterance = null;
    let currentImageFile = null;
    let currentOcrLanguage = 'eng';

    // Navigation toggle
    function toggleNav() {
      document.getElementById('navLinks').classList.toggle('active');
    }

    // Modal functions
    function openModal(type) {
      document.getElementById(`${type}Modal`).style.display = 'flex';
      if (type === 'symptom') {
        updateSymptomList();
      }
    }

    function closeModal(type) {
      document.getElementById(`${type}Modal`).style.display = 'none';
    }

    // Service modal
    function openServiceModal(title, description) {
      document.getElementById('serviceTitle').innerText = title;
      document.getElementById('serviceDescription').innerText = description;
      openModal('service');
    }

    // Authentication
    function handleAuth(type) {
      if (type === 'login') {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        if (email && password) {
          localStorage.setItem('user', JSON.stringify({ email, name: 'User' }));
          updateNav();
          alert('Login successful! (Demo mode)');
          closeModal('login');
        } else {
          alert('Please fill in all fields.');
        }
      } else if (type === 'signup') {
        const name = document.getElementById('signupName').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        if (name && email && password) {
          localStorage.setItem('user', JSON.stringify({ email, name }));
          updateNav();
          alert('Sign up successful! (Demo mode)');
          closeModal('signup');
        } else {
          alert('Please fill in all fields.');
        }
      }
    }

    function handleLogout() {
      localStorage.removeItem('user');
      updateNav();
      alert('Logged out successfully! (Demo mode)');
    }

    function updateNav() {
      const user = JSON.parse(localStorage.getItem('user'));
      const profileBtn = document.getElementById('profileBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      if (user) {
        profileBtn.style.display = 'block';
        logoutBtn.style.display = 'block';
        profileBtn.innerText = `Hi, ${user.name}`;
      } else {
        profileBtn.style.display = 'none';
        logoutBtn.style.display = 'none';
      }
    }

    // Contact form
    function handleContactSubmit() {
      const name = document.getElementById('contactName');
      const email = document.getElementById('contactEmail');
      const message = document.getElementById('contactMessage');

      if (name.value && email.value && message.value) {
        alert('Message sent! Weâ€™ll get back to you soon. (Demo mode)');
        name.value = '';
        email.value = '';
        message.value = '';
      } else {
        alert('Please fill in all fields.');
      }
    }

    // Voice Input
    let recognition = null;
    const voiceBtn = document.getElementById('voiceBtn');
    const userInput = document.getElementById('userInput');

    function toggleVoiceInput() {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Speech recognition not supported in your browser.');
        return;
      }

      if (!recognition) {
        recognition = new webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = true;
        recognition.lang = document.getElementById('languageSelect').value;

        recognition.onstart = () => {
          voiceBtn.classList.add('listening');
          voiceBtn.innerHTML = '<i class="fas fa-microphone-slash"></i> Listening...';
        };

        recognition.onresult = (event) => {
          let transcript = '';
          for (let i = event.resultIndex; i < event.results.length; i++) {
            transcript += event.results[i][0].transcript;
          }
          userInput.value = transcript;
        };

        recognition.onend = () => {
          voiceBtn.classList.remove('listening');
          voiceBtn.innerHTML = '<i class="fas fa-microphone"></i> Voice';
          recognition = null;
        };

        recognition.onerror = (event) => {
          alert('Speech recognition error: ' + event.error);
          recognition.stop();
        };

        recognition.start();
      } else {
        recognition.stop();
      }
    }

    // Voice Output
    function toggleSpeech() {
      const speakBtn = document.getElementById('speakBtn');
      if (!speechUtterance) {
        if (!latestBotMessage) {
          alert('No bot response to read yet.');
          return;
        }
        speechUtterance = new SpeechSynthesisUtterance(latestBotMessage);
        speechUtterance.lang = document.getElementById('languageSelect').value;
        speechUtterance.onend = () => {
          speakBtn.classList.remove('speaking');
          speakBtn.innerHTML = '<i class="fas fa-volume-up"></i> Speak';
          speechUtterance = null;
        };
        speakBtn.classList.add('speaking');
        speakBtn.innerHTML = '<i class="fas fa-volume-mute"></i> Stop';
        window.speechSynthesis.speak(speechUtterance);
      } else {
        window.speechSynthesis.cancel();
        speakBtn.classList.remove('speaking');
        speakBtn.innerHTML = '<i class="fas fa-volume-up"></i> Speak';
        speechUtterance = null;
      }
    }

    // OpenCV.js Ready Check
    let openCvReady = false;
    function onOpenCvReady() {
      openCvReady = true;
      console.log('OpenCV.js is ready.');
    }

    // Prescription Image Preview
    function previewPrescriptionImage(event) {
      const file = event.target.files[0];
      if (!file) {
        addMessage('No file selected.', false);
        return;
      }

      currentImageFile = file;
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('previewImage').src = e.target.result;
        openModal('imagePreview');
      };
      reader.readAsDataURL(file);
    }

    // Prescription Image Processing
    async function processConfirmedImage() {
      if (!currentImageFile) {
        addMessage('No image to process.', false);
        closeModal('imagePreview');
        return;
      }

      // Get selected OCR language
      currentOcrLanguage = document.getElementById('ocrLanguageSelect').value;

      // Display user message indicating upload
      addMessage('Uploaded prescription image.', true);
      closeModal('imagePreview');

      // Show typing indicator
      const typingIndicator = document.getElementById('typingIndicator');
      typingIndicator.style.display = 'block';

      try {
        // Load image for preprocessing
        const imgElement = new Image();
        imgElement.src = URL.createObjectURL(currentImageFile);
        await new Promise(resolve => imgElement.onload = resolve);

        // Preprocess image with OpenCV.js
        let processedImage = imgElement;
        let preprocessedImageUrl = null;
        if (openCvReady) {
          const canvas = document.createElement('canvas');
          canvas.width = imgElement.width;
          canvas.height = imgElement.height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(imgElement, 0, 0);

          let src = cv.imread(canvas);
          let dst = new cv.Mat();

          // Convert to grayscale
          cv.cvtColor(src, dst, cv.COLOR_RGBA2GRAY);

          // Apply Gaussian blur to reduce noise
          let blurred = new cv.Mat();
          cv.GaussianBlur(dst, blurred, new cv.Size(5, 5), 0, 0, cv.BORDER_DEFAULT);

          // Apply adaptive thresholding
          cv.adaptiveThreshold(blurred, dst, 255, cv.ADAPTIVE_THRESH_GAUSSIAN_C, cv.THRESH_BINARY, 11, 2);

          // Apply dilation to enhance text
          let kernel = cv.Mat.ones(3, 3, cv.CV_8U);
          cv.dilate(dst, dst, kernel, new cv.Point(-1, -1), 1);

          // Resize to a manageable size (max 800px width)
          let resized = new cv.Mat();
          let dsize = new cv.Size(800, Math.round(800 * src.rows / src.cols));
          cv.resize(dst, resized, dsize, 0, 0, cv.INTER_AREA);

          // Write processed image back to canvas
          cv.imshow(canvas, resized);
          processedImage = canvas;
          preprocessedImageUrl = canvas.toDataURL('image/png');

          // Clean up
          src.delete();
          dst.delete();
          blurred.delete();
          resized.delete();
          kernel.delete();
        } else {
          console.warn('OpenCV.js not loaded, skipping preprocessing.');
        }

        // Perform OCR using Tesseract.js
        const { data: { text } } = await Tesseract.recognize(processedImage, currentOcrLanguage, {
          logger: (m) => console.log(m),
        });

        // Hide typing indicator
        typingIndicator.style.display = 'none';

        // Clean the extracted text
        const cleanedText = text.replace(/[^\w\s\d\.\,\/\-\(\)]/g, '').trim();
        if (!cleanedText) {
          addMessage('No text detected in the image. Please upload a clearer, high-contrast image with legible text (preferably typed). Handwritten text may require neater writing.', false, [], preprocessedImageUrl);
          return;
        }

        // Parse the extracted text for medicines and dosages
        const lines = cleanedText.split('\n').filter(line => line.trim());
        let medicines = [];
        const medicineRegex = /([A-Za-z\s\-]+?)\s*(?:(\d+\.?\d*\s*(?:mg|ml|tab|cap|drops|units|mcg|g))?\s*(?:daily|twice daily|as needed|prn|bid|tid|qid|once a day|thrice daily)?)/i;

        lines.forEach(line => {
          const match = line.match(medicineRegex);
          if (match) {
            const medicine = match[1].trim();
            const dosage = match[2] || 'Not specified';
            if (medicine.length > 2) { // Avoid short non-medicine words
              medicines.push(`- **${medicine}**: ${dosage}`);
            }
          }
        });

        // Format the response
        let response = `Here is the information extracted from your prescription (Language: ${currentOcrLanguage === 'eng' ? 'English' : 'Telugu'}):\n\n`;
        if (medicines.length > 0) {
          response += medicines.join('\n') + '\n\n';
        } else {
          response += 'No specific medicines or dosages identified.\n\n';
        }
        response += '*Raw text*:\n' + cleanedText + '\n\n';
        response += '*Note*: Please verify the details with your doctor or pharmacist, as OCR may not be 100% accurate. For handwritten prescriptions, ensure neat writing and high contrast.';

        addMessage(response, false, ['Ask about a medicine?', 'General health tips?'], preprocessedImageUrl);
      } catch (error) {
        console.error('OCR error:', error);
        typingIndicator.style.display = 'none';
        addMessage('Error processing the image. Please try again with a clearer, high-contrast image with legible text (preferably typed). Handwritten text may require neater writing.', false);
      }

      // Reset the file input and image
      document.getElementById('prescriptionUpload').value = '';
      currentImageFile = null;
    }

    // OpenStreetMap Integration (Nominatim)
    async function getNearbyClinics() {
      if (!navigator.geolocation) {
        return "Geolocation is not supported by your browser.";
      }
      return new Promise((resolve) => {
        navigator.geolocation.getCurrentPosition(
          async (position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            try {
              const response = await fetch(
                `https://nominatim.openstreetmap.org/search?format=json&q=clinic&lat=${lat}&lon=${lng}&zoom=12&limit=5`,
                { headers: { 'User-Agent': 'HealthSyncSolutions/1.0 (contact@healthsync.com)' } }
              );
              const data = await response.json();
              if (data && data.length > 0) {
                const clinics = data.map((place) => ({
                  name: place.display_name.split(',')[0],
                  address: place.display_name,
                }));
                const clinicList = clinics
                  .map((clinic) => `- **${clinic.name}**: ${clinic.address}`)
                  .join('\n');
                const mapsLink = `[View more clinics on OpenStreetMap](https://www.openstreetmap.org/#map=12/${lat}/${lng}&layers=N)`;
                const mapDiv = document.getElementById('clinic-map');
                mapDiv.style.display = 'block';
                if (!window.clinicMap) {
                  window.clinicMap = L.map('clinic-map').setView([lat, lng], 12);
                  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                  }).addTo(window.clinicMap);
                } else {
                  window.clinicMap.setView([lat, lng], 12);
                }
                resolve(
                  `Here are some clinics near you:\n\n${clinicList}\n\n${mapsLink}\n\n*Please verify hours and services before visiting.*`
                );
              } else {
                resolve("No clinics found nearby.");
              }
            } catch (error) {
              resolve("Error fetching clinics. Please try again later.");
            }
          },
          () => {
            const generalLink = "[general clinic search](https://www.openstreetmap.org/search?query=clinics)";
            resolve(`Location access denied. Showing general clinic search.\n\n${generalLink}`);
          }
        );
      });
    }

    // Chatbot
    const chatMessages = document.getElementById('chatMessages');
    const typingIndicator = document.getElementById('typingIndicator');

    function parseMarkdown(text) {
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
        .replace(/ðŸ˜Š/g, '<span class="emoji">ðŸ˜Š</span>')
        .replace(/ðŸ˜·/g, '<span class="emoji">ðŸ˜·</span>');
    }

    function addMessage(content, isUser, followUps = [], preprocessedImageUrl = null) {
      const messageDiv = document.createElement('div');
      messageDiv.className = isUser ? 'message user-message' : 'message bot-message';
      messageDiv.innerHTML = parseMarkdown(content);
      if (!isUser) {
        latestBotMessage = content.replace(/\*\*|\*|ðŸ˜Š|ðŸ˜·|\[.*?\]\(.*?\)/g, '');
      } else {
        const symptoms = ['headache', 'fever', 'cough', 'stomach pain', 'pain', 'sore throat', 'fatigue'];
        const lowerContent = content.toLowerCase();
        symptoms.forEach(symptom => {
          if (lowerContent.includes(symptom) && !symptomHistory.includes(symptom)) {
            symptomHistory.push(symptom);
          }
        });
      }
      chatMessages.appendChild(messageDiv);

      if (preprocessedImageUrl) {
        const img = document.createElement('img');
        img.src = preprocessedImageUrl;
        img.className = 'preprocessed-image';
        img.alt = 'Preprocessed Prescription Image';
        messageDiv.appendChild(img);
      }

      if (!isUser && followUps.length) {
        const repliesDiv = document.createElement('div');
        repliesDiv.className = 'quick-replies';
        followUps.forEach(reply => {
          const btn = document.createElement('button');
          btn.className = 'quick-reply';
          btn.innerText = reply;
          btn.onclick = () => {
            userInput.value = reply;
            sendMessage();
          };
          repliesDiv.appendChild(btn);
        });
        chatMessages.appendChild(repliesDiv);
      }

      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function updateSymptomList() {
      const symptomList = document.getElementById('symptomList');
      symptomList.innerHTML = '';
      if (symptomHistory.length === 0) {
        symptomList.innerHTML = '<li>No symptoms recorded yet.</li>';
      } else {
        symptomHistory.forEach(symptom => {
          const li = document.createElement('li');
          li.innerText = symptom.charAt(0).toUpperCase() + symptom.slice(1);
          li.style.padding = '0.5rem 0';
          symptomList.appendChild(li);
        });
      }
    }

    function simulateTyping(content, callback) {
      typingIndicator.style.display = 'block';
      setTimeout(() => {
        typingIndicator.style.display = 'none';
        callback();
      }, 1000);
    }

    async function sendMessage() {
      const prompt = userInput.value.trim();
      const lang = document.getElementById('languageSelect').value;

      if (!prompt) {
        addMessage('Please enter a question or symptom.', false);
        return;
      }

      addMessage(prompt, true);
      userInput.value = '';

      const clinicKeywords = ['nearby clinics', 'clinics near me', 'hospitals near me', 'find clinic', 'find hospital'];
      const isClinicQuery = clinicKeywords.some(keyword => prompt.toLowerCase().includes(keyword));

      if (isClinicQuery) {
        simulateTyping(prompt, async () => {
          const response = await getNearbyClinics();
          addMessage(response, false, ['General health tips?', 'Symptom checker']);
        });
        return;
      }

      simulateTyping(prompt, async () => {
        try {
          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GOOGLE_GEMINI_API_KEY}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts: [{ text: `As a health assistant, answer: ${prompt} *For precise advice, consult a healthcare professional.*` }] }]
            })
          });

          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }

          const data = await response.json();
          const reply = data.candidates[0].content.parts[0].text || 'Sorry, I couldnâ€™t process that. Try again!';
          
          const followUps = reply.includes('headache') ? ['Tips for stress relief?', 'More about dehydration?'] :
                           reply.includes('fever') ? ['How to stay hydrated?', 'When to see a doctor?'] :
                           ['General health tips?', 'More details?'];

          addMessage(reply, false, followUps);
        } catch (error) {
          console.error('Gemini API error:', error);
          let response = healthResponses.default;
          for (const key in healthResponses) {
            if (prompt.toLowerCase().includes(key) && key !== 'default') {
              response = healthResponses[key];
              break;
            }
          }

          if (lang !== 'en-US' && response === healthResponses.default) {
            addMessage(translations[lang].default, false);
          } else {
            addMessage(response.reply, false, response.followUps || []);
          }
        }
      });
    }

    userInput.addEventListener('input', () => {
      typingIndicator.style.display = userInput.value ? 'block' : 'none';
    });

    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    window.addEventListener('load', () => {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
      }
    });

    window.addEventListener('load', () => {
      updateNav();
      document.getElementById('logoutBtn').addEventListener('click', handleLogout);
      document.getElementById('askBtn').addEventListener('click', sendMessage);

      const sections = document.querySelectorAll('section');
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, { threshold: 0.2 });

      sections.forEach(section => observer.observe(section));
    });

    window.addEventListener('click', (event) => {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
      }
    });

    function scrollToChat() {
      document.getElementById("chat").scrollIntoView({ behavior: "smooth" });
    }
  </script>
</body>

</html>